<%
  active_tab = defined?(active) ? active : tabs.first[:id]
%>

<div class="border-b border-gray-200 dark:border-gray-600 mb-8">
  <nav class="-mb-px flex space-x-8 overflow-x-auto" aria-label="Tabs">
    <% tabs.each do |tab| %>
      <a 
        href="#<%= tab[:id] %>" 
        class="<%= active_tab == tab[:id] ? 'border-indigo-500 text-indigo-600 dark:text-indigo-400' : 'border-transparent text-gray-500 dark:text-gray-400 hover:text-gray-700 dark:hover:text-gray-300 hover:border-gray-300 dark:hover:border-gray-600' %> whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm"
        data-tab="<%= tab[:id] %>"
      >
        <%= tab[:label] %>
      </a>
    <% end %>
  </nav>
</div>

<script>
  document.addEventListener('DOMContentLoaded', function() {
    const tabGroups = new Map();
    
    document.querySelectorAll('[data-tab]').forEach(tab => {
      let container = tab.closest('[data-tab-group]');
      if (!container) {
        container = tab.closest('nav').parentElement;
      }
      
      if (!tabGroups.has(container)) {
        tabGroups.set(container, {
          tabs: [],
          sections: [],
          isMain: !container.hasAttribute('data-tab-group')
        });
      }
      
      const group = tabGroups.get(container);
      group.tabs.push(tab);
    });
    
    document.querySelectorAll('[data-tab-content]').forEach(section => {
      const tabId = section.dataset.tabContent;
      const tab = document.querySelector(`[data-tab="${tabId}"]`);
      if (tab) {
        let container = tab.closest('[data-tab-group]');
        if (!container) {
          container = tab.closest('nav').parentElement;
        }
        const group = tabGroups.get(container);
        if (group) {
          group.sections.push(section);
        }
      }
    });
    
    tabGroups.forEach((group, container) => {
      function showTab(tabId) {
        group.tabs.forEach(tab => {
          const isActive = tab.dataset.tab === tabId;
          if (isActive) {
            tab.classList.remove('border-transparent', 'text-gray-500', 'dark:text-gray-400');
            tab.classList.add('border-indigo-500', 'text-indigo-600', 'dark:text-indigo-400');
          } else {
            tab.classList.add('border-transparent', 'text-gray-500', 'dark:text-gray-400');
            tab.classList.remove('border-indigo-500', 'text-indigo-600', 'dark:text-indigo-400');
          }
        });
        
        group.sections.forEach(section => {
          if (section.dataset.tabContent === tabId) {
            section.classList.remove('hidden');
          } else {
            section.classList.add('hidden');
          }
        });
        
        if (group.isMain) {
          history.replaceState(null, '', '#' + tabId);
        }
      }
      
      group.tabs.forEach(tab => {
        tab.addEventListener('click', (e) => {
          e.preventDefault();
          showTab(tab.dataset.tab);
        });
      });
      
      if (group.isMain) {
        const hash = window.location.hash.slice(1);
        if (hash) {
          showTab(hash);
        }
      }
    });
  });
</script>

