#!/usr/bin/env ruby
require 'fileutils'

puts '==> Setting up Tails ðŸ¦Š...'

unless File.exist?('.env')
  puts "\n==> Creating .env file with secure session secret..."
  require 'securerandom'

  env_content = File.read('env.example')
  session_secret = SecureRandom.hex(64)
  env_content.gsub!('your-secret-key-here', session_secret)

  File.write('.env', env_content)
  puts "âœ“ Generated secure SESSION_SECRET"
end

puts "\n==> Guide Documentation Setup"
puts "Tails includes built-in guide documentation at /guide."
puts "This is helpful for learning the framework but can be removed for production."
print "\nDo you want to keep the guide documentation? (y/n): "
keep_guide = $stdin.gets.chomp.downcase

if keep_guide == 'n' || keep_guide == 'no'
  puts "\n==> Removing guide documentation..."
  system('ruby bin/remove-guide') || abort('Failed to remove guide')
else
  puts "âœ“ Keeping guide documentation"
end

puts "\n==> Installing dependencies..."
system('bundle install') || abort('Failed to install dependencies')

puts "\n==> Creating database directory..."
FileUtils.mkdir_p('db')

puts "\n==> Running migrations..."
system('bundle exec rake db:migrate') || abort('Failed to run migrations')

puts "\n==> Seeding database..."
system('bundle exec rake db:seed')

puts "\n==> Setup complete!"
puts "\nTo start the application:"
puts '  bundle exec falcon serve'
puts "\nOr with rackup:"
puts '  bundle exec rackup'
puts "\nDemo credentials:"
puts '  Email: demo@example.com'
puts '  Password: password123'
